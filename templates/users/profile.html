{% extends "base.html" %}
{% block title %}{{ user.name }}'s Profile â€“ LUMO{% endblock %}
{% block content %}

<div class="profile-header card-glass" style="padding: 32px; margin-bottom: 48px;">
  <div style="display: flex; gap: 24px; align-items: center;">
    <div class="profile-avatar">
      {% if user.avatar %}
        <img src="{{ user.avatar }}" alt="{{ user.name }}" style="width: 100%; height: 100%; object-fit: cover;">
      {% else %}
        {{ user.name[0]|upper }}
      {% endif %}
    </div>
    <div style="flex: 1;">
      <h1 style="margin-bottom: 8px;">{{ user.name }}</h1>
      <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
        <span class="badge-pill">ğŸ“… Member since {{ user.created_at.strftime('%b %Y') }}</span>
        <span class="badge-pill">â­ {{ reviewed_movies|length }} Reviews</span>
        <span class="badge-pill">ğŸ“‹ {{ watchlist|length }} in Watchlist</span>
      </div>
      {% if user.bio %}
      <p style="color: var(--muted); line-height: 1.6; margin-bottom: 16px;">
        {{ user.bio }}
      </p>
      {% else %}
      <p style="color: var(--muted); line-height: 1.6; margin-bottom: 16px;">
        No bio yet.
      </p>
      {% endif %}
      <a href="{{ url_for('users.edit_profile') }}" class="btn-secondary">
        âœï¸ Edit Profile
      </a>
    </div>
  </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div style="background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.4); border-radius: 12px; padding: 12px; margin-bottom: 24px; color: #86efac;">
      {% for message in messages %}
        {{ message }}
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Reviewed Movies -->
<section style="margin-bottom: 48px;">
  <h2 style="margin-bottom: 24px;">ğŸ¬ Movies You've Reviewed</h2>
  
  {% if reviewed_movies %}
  <div class="movie-grid">
    {% for item in reviewed_movies %}
    <a href="{{ url_for('movies.movie_detail', movie_id=item.movie.id) }}" style="text-decoration: none; color: inherit;">
      <div class="card-glass">
        {% if item.movie.poster_url %}
        <img src="{{ item.movie.poster_url }}" alt="{{ item.movie.title }}" class="movie-poster" />
        {% else %}
        <div class="movie-poster" style="background: linear-gradient(135deg, #4f46e5, #ec4899); display: flex; align-items: center; justify-content: center; font-size: 3rem;">
          ğŸ¬
        </div>
        {% endif %}
        <div class="movie-title">{{ item.movie.title }}</div>
        <div style="display: flex; gap: 4px; color: #fbbf24; margin: 8px 0; font-size: 0.9rem;">
          {% for i in range(item.review.rating) %}â­{% endfor %}
        </div>
        <div class="movie-meta" style="font-size: 0.8rem; line-height: 1.4;">
          {{ item.review.review_text[:80] }}{% if item.review.review_text|length > 80 %}...{% endif %}
        </div>
      </div>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="card-glass" style="padding: 40px; text-align: center;">
    <p style="color: var(--muted); margin-bottom: 16px;">You haven't reviewed any movies yet.</p>
    <a href="{{ url_for('movies.movie_list') }}" class="btn-primary">
      Browse Movies
    </a>
  </div>
  {% endif %}
</section>

<!-- Watchlist -->
<section style="margin-bottom: 48px;">
  <h2 style="margin-bottom: 24px;">ğŸ“‹ Your Watchlist</h2>
  
  {% if watchlist %}
  <div class="movie-grid">
    {% for movie in watchlist %}
    <a href="{{ url_for('movies.movie_detail', movie_id=movie.id) }}" style="text-decoration: none; color: inherit;">
      <div class="card-glass">
        {% if movie.poster_url %}
        <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="movie-poster" />
        {% else %}
        <div class="movie-poster" style="background: linear-gradient(135deg, #4f46e5, #ec4899); display: flex; align-items: center; justify-content: center; font-size: 3rem;">
          ğŸ¬
        </div>
        {% endif %}
        <div class="movie-title">{{ movie.title }}</div>
        <div class="movie-meta">
          {% if movie.release_date %}{{ movie.release_date[:4] }} â€¢ {% endif %}
          â­ {{ movie.vote_average|round(1) }}/10
        </div>
      </div>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="card-glass" style="padding: 40px; text-align: center;">
    <p style="color: var(--muted); margin-bottom: 16px;">Your watchlist is empty.</p>
    <a href="{{ url_for('movies.movie_list') }}" class="btn-primary">
      Discover Movies
    </a>
  </div>
  {% endif %}
</section>

<style>
  .btn-primary:hover, .btn-secondary:hover {
    transform: translateY(-2px);
  }
  
  .btn-primary:hover {
    box-shadow: 0 12px 24px rgba(123, 92, 255, 0.4);
  }
  
  .btn-secondary:hover {
    border-color: var(--accent);
  }
</style>

{% endblock %}