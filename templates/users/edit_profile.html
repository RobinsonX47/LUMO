{% extends "base.html" %}
{% block title %}Edit Profile â€“ LUMO{% endblock %}
{% block content %}

<div style="max-width: 700px; margin: 40px auto;">
  <div class="card-glass" style="padding: 48px;">
    <h1 style="margin-bottom: 12px;">Edit Profile</h1>
    <p style="color: var(--muted); margin-bottom: 40px;">Update your account information and avatar</p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message flash-{{ category }}" style="margin-bottom: 24px;">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('users.edit_profile') }}" enctype="multipart/form-data">
      
      <!-- Avatar Upload Section -->
      <div style="margin-bottom: 40px; text-align: center;">
        <div class="avatar-upload-wrapper">
          <div class="avatar-preview" id="avatarPreview">
            {% if user.avatar %}
              <img src="{{ user.avatar }}" alt="{{ user.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" />
            {% else %}
              <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 4rem; background: linear-gradient(135deg, var(--accent), #0066cc); border-radius: 50%; color: white; font-weight: 700;">
                {{ user.name[0]|upper }}
              </div>
            {% endif %}
          </div>
          
          <div style="margin-top: 20px;">
            <label for="avatar" class="btn-secondary" style="cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
              Upload Avatar
            </label>
            <input type="file" name="avatar" id="avatar" accept="image/*" style="display: none;" />
            <div id="fileName" style="margin-top: 12px; color: var(--text-muted); font-size: 0.85rem;"></div>
          </div>
        </div>
      </div>

      <div style="margin-bottom: 24px;">
        <label style="display: block; margin-bottom: 10px; font-size: 0.95rem; color: var(--text-secondary); font-weight: 500;">Full Name</label>
        <input 
          type="text" 
          name="name" 
          value="{{ user.name }}"
          required 
          style="width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255, 255, 255, 0.05); color: var(--text); font-size: 1rem;"
        />
      </div>

      <div style="margin-bottom: 24px;">
        <label style="display: block; margin-bottom: 10px; font-size: 0.95rem; color: var(--text-secondary); font-weight: 500;">Email</label>
        <input 
          type="email" 
          value="{{ user.email }}"
          disabled
          style="width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255, 255, 255, 0.02); color: var(--text-muted); font-size: 1rem; cursor: not-allowed;"
        />
        <small style="color: var(--text-muted); font-size: 0.8rem; display: block; margin-top: 6px;">Email cannot be changed</small>
      </div>

      <div style="margin-bottom: 24px;">
        <label style="display: block; margin-bottom: 10px; font-size: 0.95rem; color: var(--text-secondary); font-weight: 500;">Bio</label>
        <textarea 
          name="bio" 
          rows="4"
          placeholder="Tell us about yourself..."
          style="width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255, 255, 255, 0.05); color: var(--text); font-size: 1rem; resize: vertical; font-family: inherit; line-height: 1.6;"
        >{{ user.bio or '' }}</textarea>
      </div>

      <div style="margin-bottom: 32px;">
        <label style="display: block; margin-bottom: 10px; font-size: 0.95rem; color: var(--text-secondary); font-weight: 500;">New Password</label>
        <input 
          type="password" 
          name="password" 
          minlength="6"
          placeholder="Leave blank to keep current password"
          style="width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255, 255, 255, 0.05); color: var(--text); font-size: 1rem;"
        />
        <small style="color: var(--text-muted); font-size: 0.8rem; display: block; margin-top: 6px;">Minimum 6 characters</small>
      </div>

      <div style="display: flex; gap: 12px; padding-top: 12px; border-top: 1px solid var(--glass-border);">
        <button 
          type="submit" 
          class="btn-primary"
          style="flex: 1; padding: 16px 32px; border-radius: 12px; border: none; background: var(--accent); color: white; font-weight: 600; cursor: pointer; font-size: 1rem; transition: var(--transition);"
        >
          Save Changes
        </button>
        
        <a href="{{ url_for('users.profile') }}"
           class="btn-secondary"
           style="display: inline-flex; align-items: center; justify-content: center; padding: 16px 24px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255, 255, 255, 0.05); color: var(--text); text-decoration: none; font-size: 1rem; font-weight: 500; transition: var(--transition);">
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<style>
  .avatar-upload-wrapper {
    display: inline-block;
  }

  .avatar-preview {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    overflow: hidden;
    border: 4px solid var(--glass-border);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    margin: 0 auto;
  }

  .btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(10, 132, 255, 0.4);
  }

  .btn-secondary:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.08);
  }

  input:focus, textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.1);
  }
</style>

<script>
  // Avatar preview
  document.getElementById('avatar').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const fileName = document.getElementById('fileName');
    const preview = document.getElementById('avatarPreview');
    
    if (file) {
      fileName.textContent = file.name;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `<img src="${e.target.result}" alt="Avatar Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" />`;
      };
      reader.readAsDataURL(file);
    } else {
      fileName.textContent = '';
    }
  });
</script>

{% endblock %}