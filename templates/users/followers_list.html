{% extends "base.html" %} {% block title %}{{ user.name }}'s Followers – LUMO{%
endblock %} {% block content %}

<input type="hidden" id="csrf_token" value="{{ csrf_token() }}" />

<div style="max-width: 900px; margin: 40px auto; padding: 0 20px">
  <!-- Header -->
  <div
    style="display: flex; align-items: center; gap: 16px; margin-bottom: 40px"
  >
    <div
      style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden"
    >
      {% if user.avatar %}
      <img
        src="{{ user.avatar }}"
        alt="{{ user.name }}"
        style="width: 100%; height: 100%; object-fit: cover"
      />
      {% else %}
      <div
        style="
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          background: var(--gradient);
          font-size: 24px;
        "
      >
        {{ user.name[0]|upper }}
      </div>
      {% endif %}
    </div>
    <div>
      <h1 style="margin-bottom: 4px">{{ user.name }}'s Followers</h1>
      <p style="color: var(--muted)">{{ followers.total }} followers</p>
    </div>
  </div>

  <!-- Search Box -->
  <form method="GET" style="display: flex; gap: 12px; margin-bottom: 32px">
    <input
      type="text"
      name="search"
      placeholder="Search followers..."
      value="{{ search }}"
      style="
        flex: 1;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid var(--glass-border);
        background: rgba(255, 255, 255, 0.05);
        color: var(--text);
        font-size: 1rem;
      "
    />
    <button type="submit" class="btn-primary" style="white-space: nowrap">
      Search
    </button>
  </form>

  <!-- Followers List -->
  {% if followers.items %}
  <div style="display: flex; flex-direction: column; gap: 16px">
    {% for follower in followers.items %}
    <div
      class="card-glass"
      style="
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      "
    >
      <!-- User Info -->
      <a
        href="{{ url_for('users.public_profile', username=follower.username) }}"
        style="
          text-decoration: none;
          color: inherit;
          display: flex;
          align-items: center;
          gap: 16px;
          flex: 1;
        "
      >
        <div
          style="
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
          "
        >
          {% if follower.avatar %}
          <img
            src="{{ follower.avatar }}"
            alt="{{ follower.name }}"
            style="width: 100%; height: 100%; object-fit: cover"
          />
          {% else %}
          <div
            style="
              width: 100%;
              height: 100%;
              display: flex;
              align-items: center;
              justify-content: center;
              background: var(--gradient);
              font-size: 18px;
            "
          >
            {{ follower.name[0]|upper }}
          </div>
          {% endif %}
        </div>
        <div>
          <h4 style="margin-bottom: 2px">{{ follower.name }}</h4>
          <p style="color: var(--muted); font-size: 13px">
            @{{ follower.username }}
          </p>
        </div>
      </a>

      <!-- Follow Button -->
      {% if current_user.is_authenticated and current_user.id != follower.id %}
      {% if follower.id in following_ids %}
      <button
        class="btn-secondary"
        onclick="unfollowUser(this, {{ follower.id }})"
        style="white-space: nowrap; padding: 10px 16px"
      >
        ✓ Following
      </button>
      {% else %}
      <button
        class="btn-primary"
        onclick="followUser(this, {{ follower.id }})"
        style="white-space: nowrap; padding: 10px 16px"
      >
        + Follow
      </button>
      {% endif %} {% endif %}
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if followers.pages > 1 %}
  <div
    style="display: flex; justify-content: center; gap: 12px; margin-top: 48px"
  >
    {% if followers.has_prev %}
    <a
      href="{{ url_for('users.followers_list', username=user.username, page=followers.prev_num, search=search) }}"
      class="btn-tertiary"
      >← Previous</a
    >
    {% endif %} {% for page_num in followers.iter_pages() %} {% if page_num %}
    {% if page_num == followers.page %}
    <span class="btn-tertiary" style="background: var(--primary); color: white"
      >{{ page_num }}</span
    >
    {% else %}
    <a
      href="{{ url_for('users.followers_list', username=user.username, page=page_num, search=search) }}"
      class="btn-tertiary"
      >{{ page_num }}</a
    >
    {% endif %} {% endif %} {% endfor %} {% if followers.has_next %}
    <a
      href="{{ url_for('users.followers_list', username=user.username, page=followers.next_num, search=search) }}"
      class="btn-tertiary"
      >Next →</a
    >
    {% endif %}
  </div>
  {% endif %} {% else %}
  <div style="text-align: center; padding: 60px 20px">
    <h3 style="margin-bottom: 8px">No Followers Found</h3>
    <p style="color: var(--muted)">
      {% if search %}No followers match your search{% else %}{{ user.name }} has
      no followers yet{% endif %}
    </p>
  </div>
  {% endif %}
</div>

<style>
  .btn-tertiary {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: var(--text);
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .btn-tertiary:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.25);
  }

  .card-glass:hover {
    transform: translateX(4px);
  }

  @media (max-width: 768px) {
    .card-glass {
      flex-direction: column;
      text-align: center;
    }
  }
</style>

<script>
  function followUser(btn, userId) {
    fetch(
      `{{ url_for('users.follow_user', user_id=0) }}`.replace(
        "/0/",
        `/${userId}/`,
      ),
      {
        method: "POST",
        headers: {
          "X-CSRFToken": document.getElementById("csrf_token").value,
        },
      },
    )
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          btn.textContent = "✓ Following";
          btn.className = "btn-secondary";
          btn.onclick = function () {
            unfollowUser(btn, userId);
          };
        }
      });
  }

  function unfollowUser(btn, userId) {
    fetch(
      `{{ url_for('users.unfollow_user', user_id=0) }}`.replace(
        "/0/",
        `/${userId}/`,
      ),
      {
        method: "POST",
        headers: {
          "X-CSRFToken": document.getElementById("csrf_token").value,
        },
      },
    )
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          btn.textContent = "+ Follow";
          btn.className = "btn-primary";
          btn.onclick = function () {
            followUser(btn, userId);
          };
        }
      });
  }
</script>

{% endblock %}
